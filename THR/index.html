<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¶€í’ˆê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f2f2f2; font-family: 'Segoe UI', sans-serif; padding-bottom: 80px; }
    header { padding: 20px; background-color: #003366; color: white; }
    .container { margin-top: 20px; }
    .table thead th { background-color: #d9e2ef; text-align: center; }
    .table tbody td { text-align: center; vertical-align: middle; }
    .status-in { background-color: #d0ebff; }
    .status-out { background-color: #ffc9c9; }
    .status-low { background-color: #fff3cd; }
    .status-none { background-color: #dee2e6; }
    .part-img { width: 60px; height: 60px; object-fit: contain; border: 1px solid #ccc; border-radius: 6px; }
  </style>
</head>
<body>
  <header>
    <h2>ğŸš¢ ë¶€í’ˆê´€ë¦¬ ì‹œìŠ¤í…œ</h2>
    <p>ì…ê³  Â· ì¶œê³  Â· ì¬ê³ í˜„í™©</p>
  </header>

  <div class="container">
    <div class="mb-3 text-end">
      <button class="btn btn-secondary me-2" data-bs-toggle="modal" data-bs-target="#searchModal">ê²€ìƒ‰</button>
      <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#registerModal">ì…ì¶œê³  ë“±ë¡</button>
      <button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#chartModal">ğŸ“ˆ ê·¸ë˜í”„ ë³´ê¸°</button>
    </div>

    <table class="table table-bordered table-hover">
      <thead>
        <tr>
          <th>ì‚¬ì§„</th><th>ë¶€í’ˆì½”ë“œ</th><th>ë¶€í’ˆëª…</th><th>ê·œê²©</th><th>ì…ê³ ì¼</th><th>ì¶œê³ ì¼</th><th>ì¬ê³ ìˆ˜ëŸ‰</th><th>ìƒíƒœ</th><th>ì‘ì—…</th>
        </tr>
      </thead>
      <tbody>
        {% for part in parts %}
        <tr class="status-{{ 'in' if part.status == 'ì…ê³ ì™„ë£Œ' else 'out' if part.status == 'ì¶œê³ ì™„ë£Œ' else 'low' if part.status == 'ì¬ê³ ë¶€ì¡±' else 'none' }}">
          <td><img src="{{ url_for('static', filename='images/' + part.image) }}" alt="{{ part.partName }}" class="part-img" /></td>
          <td>{{ part.partCode }}</td>
          <td>{{ part.partName }}</td>
          <td>{{ part.spec }}</td>
          <td>{{ part.inDate or '-' }}</td>
          <td>{{ part.outDate or '-' }}</td>
          <td>{{ part.quantity }}</td>
          <td>{{ part.status }}</td>
          <td>
            <a href="{{ url_for('edit', part_id=part._id) }}" class="btn btn-sm btn-outline-primary">ìˆ˜ì •</a>
            <a href="{{ url_for('delete', part_id=part._id) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">ì‚­ì œ</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Chart Modal -->
  <div class="modal fade" id="chartModal" tabindex="-1" aria-labelledby="chartModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="chartModalLabel">ë¶€í’ˆì½”ë“œë³„ ì¬ê³  ìˆ˜ëŸ‰ ê·¸ë˜í”„</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
        </div>
        <div class="modal-body">
          <canvas id="barChart" height="100"></canvas>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
        </div>
      </div>
    </div>
  </div>
  <!-- ë“±ë¡ ëª¨ë‹¬ -->
  <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <form class="modal-content" method="POST" enctype="multipart/form-data" action="/register">
        <div class="modal-header">
          <h5 class="modal-title" id="registerModalLabel">ì…ì¶œê³  ë“±ë¡</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
        </div>
        <div class="modal-body row g-3 px-4">
          <div class="col-md-6"><label class="form-label">ì‚¬ì§„</label><input type="file" name="partImage" class="form-control" required></div>
          <div class="col-md-6"><label class="form-label">ë¶€í’ˆì½”ë“œ</label><input type="text" name="partCode" class="form-control" required></div>
          <div class="col-md-6"><label class="form-label">ë¶€í’ˆëª…</label><input type="text" name="partName" class="form-control" required></div>
          <div class="col-md-6"><label class="form-label">ê·œê²©</label><input type="text" name="spec" class="form-control" required></div>
          <div class="col-md-6"><label class="form-label">ì…ê³ ì¼</label><input type="date" name="inDate" class="form-control"></div>
          <div class="col-md-6"><label class="form-label">ì¶œê³ ì¼</label><input type="date" name="outDate" class="form-control"></div>
          <div class="col-md-6"><label class="form-label">ì¬ê³ ìˆ˜ëŸ‰</label><input type="number" name="quantity" class="form-control" required></div>
          <div class="col-md-6">
            <label class="form-label">ìƒíƒœ</label>
            <select name="status" class="form-select" required>
              <option value="">ì„ íƒ</option>
              <option value="ì…ê³ ì™„ë£Œ">ì…ê³ ì™„ë£Œ</option>
              <option value="ì¶œê³ ì™„ë£Œ">ì¶œê³ ì™„ë£Œ</option>
              <option value="ì¬ê³ ë¶€ì¡±">ì¬ê³ ë¶€ì¡±</option>
              <option value="ë¯¸ì…ê³ ">ë¯¸ì…ê³ </option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
          <button type="submit" class="btn btn-primary">ë“±ë¡</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ê²€ìƒ‰ ëª¨ë‹¬ -->
  <div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <form class="modal-content" method="POST" action="/search">
        <div class="modal-header">
          <h5 class="modal-title" id="searchModalLabel">ë¶€í’ˆ ê²€ìƒ‰</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
        </div>
        <div class="modal-body row g-3 px-4">
          <div class="col-md-6"><label class="form-label">ë¶€í’ˆì½”ë“œ</label><input type="text" name="searchPartCode" class="form-control"></div>
          <div class="col-md-6"><label class="form-label">ë¶€í’ˆëª…</label><input type="text" name="searchPartName" class="form-control"></div>
          <div class="col-md-6"><label class="form-label">ê·œê²©</label><input type="text" name="searchSpec" class="form-control"></div>
          <div class="col-md-6">
            <label class="form-label">ìƒíƒœ</label>
            <select name="searchStatus" class="form-select">
              <option value="">ì „ì²´</option>
              <option value="ì…ê³ ì™„ë£Œ">ì…ê³ ì™„ë£Œ</option>
              <option value="ì¶œê³ ì™„ë£Œ">ì¶œê³ ì™„ë£Œ</option>
              <option value="ì¬ê³ ë¶€ì¡±">ì¬ê³ ë¶€ì¡±</option>
              <option value="ë¯¸ì…ê³ ">ë¯¸ì…ê³ </option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="reset" class="btn btn-secondary">ì´ˆê¸°í™”</button>
          <button type="submit" class="btn btn-success">ê²€ìƒ‰</button>
        </div>
      </form>
    </div>
  </div>

  <!-- í‘¸í„° -->
  <footer class="text-center text-muted small fixed-bottom bg-light py-2 border-top">
    â“’ 2025 ëª½ê³  ë°ì´í„°ë² ì´ìŠ¤ ê°œë°œê³¼ì • - Gabkeun Choi, Ph.D.
  </footer>

  <!-- Bootstrap & Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const labels = {{ chart_labels | tojson | safe }};
    const data = {{ chart_data | tojson | safe }};

    const barCtx = document.getElementById('barChart').getContext('2d');
    new Chart(barCtx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'ì¬ê³  ìˆ˜ëŸ‰',
          data: data,
          backgroundColor: 'rgba(54, 162, 235, 0.5)',
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: true } },
        scales: { y: { beginAtZero: true } }
      }
    });
  </script>
</body>
</html>